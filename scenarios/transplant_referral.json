{
  "metadata": {
    "id": "transplant_referral_evaluation_hla_normalization",
    "title": "Transplant Referral Evaluation with Cross-Institution Data Normalization",
    "description": "Transplant center agent evaluates a referral by collaborating with an outside hospital EHR agent to collect labs, imaging, and normalize HLA data formats through conversation.",
    "background": "In transplant medicine, evaluating a patient referral requires gathering data from the referring hospital's EHR, including recent labs, imaging reports, and HLA typing. Due to varying data formats across institutions, agents must negotiate and normalize HLA data (e.g., converting antigen codes to alleles) via conversational exchange, ensuring compatibility for transplant matching without direct system-to-system integration.",
    "challenges": [
      "Verifying patient identity across institutions",
      "Negotiating specific data requirements progressively",
      "Normalizing disparate HLA data formats through discussion",
      "Ensuring data privacy by sharing only necessary details via attachments"
    ],
    "tags": [
      "transplant",
      "interoperability",
      "hla-typing",
      "data-normalization",
      "verification"
    ]
  },
  "agents": [
    {
      "agentId": "transplant_center",
      "principal": {
        "type": "organization",
        "name": "City General Transplant Center",
        "description": "Specialized transplant evaluation and coordination organization"
      },
      "situation": "A referral has been received for patient John Doe (MRN: TC-12345, DOB: 1980-05-15) for kidney transplant evaluation. Initial intake indicates possible end-stage renal disease, but detailed labs, imaging, and HLA typing from the referring hospital are needed.",
      "systemPrompt": "You are an agent representing City General Transplant Center. Your role is to evaluate transplant referrals by collaborating with referring hospital agents. Begin by introducing yourself and the referral objective. Confirm patient identity (full name, DOB, MRN/member ID) and the referring provider's details before requesting data. Negotiate specific requirements (e.g., recent labs from last 6 months, imaging reports within 3 months, HLA typing) progressivelyâ€”ask what formats are available and discuss normalization needs (e.g., HLA antigen to allele conversion for compatibility assessment). Use tools to retrieve internal referral details, normalize received HLA data, and perform suitability analysis only after collecting necessary information. Share only aggregated insights and formal assessments, not raw external data. Favor progressive disclosure: retrieve and share only what's needed for the current evaluation step. When ready to conclude, use the analysis tool to generate the formal assessment report.",
      "goals": [
        "Verify referral and patient identity",
        "Collect and normalize cross-institution labs, imaging, and HLA data",
        "Evaluate transplant suitability and issue a formal assessment"
      ],
      "tools": [
        {
          "toolName": "retrieve_referral_details",
          "description": "Retrieve details about a specific transplant referral from the referral database using natural language query",
          "inputSchema": {
            "type": "object",
            "properties": {
              "query": {
                "type": "string",
                "description": "Natural language query about the referral (e.g., 'details for patient MRN TC-12345 kidney transplant referral')"
              }
            },
            "required": [
              "query"
            ]
          },
          "synthesisGuidance": "Search knowledgeBase.patientReferrals matching the query. Return as markdown with referral date, referring hospital, initial diagnosis, and contact information.",
          "endsConversation": false
        },
        {
          "toolName": "normalize_hla_data",
          "description": "Normalize HLA data from antigen format to allele format using the reference mapping database",
          "inputSchema": {
            "type": "object",
            "properties": {
              "hlaData": {
                "type": "object",
                "description": "HLA data object with antigens to normalize (e.g., {A: ['A1', 'A2'], B: ['B8', 'B44']})"
              },
              "normalizationRequest": {
                "type": "string",
                "description": "Specific normalization instructions (e.g., 'convert A and B locus antigens to primary alleles')"
              }
            },
            "required": [
              "hlaData",
              "normalizationRequest"
            ]
          },
          "synthesisGuidance": "Use knowledgeBase.hlaReference.antigenToAlleleMap to convert provided antigens to alleles. Return as JSON with original antigens, possible alleles, and confidence levels. Include compatibility notes for kidney transplant based on knowledgeBase.hlaReference.compatibilityCriteria.",
          "endsConversation": false
        },
        {
          "toolName": "analyze_transplant_suitability",
          "description": "Analyze collected patient data (labs, imaging, HLA) to determine transplant suitability and generate formal assessment",
          "inputSchema": {
            "type": "object",
            "properties": {
              "patientData": {
                "type": "object",
                "description": "Compiled patient data including labs, imaging findings, and normalized HLA typing"
              },
              "analysisCriteria": {
                "type": "string",
                "description": "Specific analysis focus (e.g., 'kidney transplant candidacy based on renal function and HLA matching potential')"
              }
            },
            "required": [
              "patientData",
              "analysisCriteria"
            ]
          },
          "synthesisGuidance": "Analyze the provided patientData against transplant evaluation criteria. Generate a formal suitability report using knowledgeBase.evaluationTemplates.suitabilityReport. Include recommendations, risk assessment, and next steps. Format as professional medical assessment letter.",
          "endsConversation": true,
          "conversationEndStatus": "success"
        },
        {
          "toolName": "reject_referral",
          "description": "Formally reject a transplant referral due to insufficient data or ineligibility and generate rejection notice",
          "inputSchema": {
            "type": "object",
            "properties": {
              "patientId": {
                "type": "string",
                "description": "Patient MRN for the referral"
              },
              "rejectionReason": {
                "type": "string",
                "description": "Detailed clinical or procedural reason for rejection"
              }
            },
            "required": [
              "patientId",
              "rejectionReason"
            ]
          },
          "synthesisGuidance": "Generate formal rejection letter explaining the decision and rationale. Include contact information for appeal process. Use professional medical language.",
          "endsConversation": true,
          "conversationEndStatus": "failure"
        }
      ],
      "knowledgeBase": {
        "patientReferrals": {
          "TC-12345": {
            "name": "John Doe",
            "dob": "1980-05-15",
            "initialDiagnosis": "End-stage renal disease (ESRD) suspected based on referral",
            "referralDate": "2024-10-01",
            "referringHospital": "Regional General Hospital",
            "referringProvider": "Dr. Emily Carter, Nephrologist",
            "contactInfo": "emily.carter@regionalgeneral.org, (555) 123-4567",
            "preliminaryNotes": "Patient reports progressive fatigue and swelling over past 6 months"
          }
        },
        "hlaReference": {
          "antigenToAlleleMap": {
            "A1": [
              "A*01:01",
              "A*01:02"
            ],
            "A2": [
              "A*02:01",
              "A*02:02",
              "A*02:03",
              "A*02:05",
              "A*02:06"
            ],
            "B8": [
              "B*08:01",
              "B*08:02"
            ],
            "B44": [
              "B*44:02",
              "B*44:03"
            ],
            "DR3": [
              "DRB1*03:01",
              "DRB1*03:02"
            ],
            "DR4": [
              "DRB1*04:01",
              "DRB1*04:02",
              "DRB1*04:03",
              "DRB1*04:04",
              "DRB1*04:05"
            ]
          },
          "compatibilityCriteria": {
            "kidney": {
              "hlaMatchThreshold": 4,
              "acceptableMismatches": 2,
              "preferredAlleles": [
                "A*02:01",
                "B*08:01",
                "DRB1*03:01"
              ],
              "riskFactors": [
                "High PRA levels",
                "Previous sensitizing events"
              ]
            }
          },
          "normalizationGuidelines": "When multiple alleles possible for an antigen, select most common or request high-resolution typing"
        },
        "evaluationTemplates": {
          "suitabilityReport": {
            "header": "Transplant Suitability Assessment - City General Transplant Center",
            "sections": [
              "Patient Identification",
              "Clinical Summary",
              "Laboratory Analysis",
              "Imaging Findings",
              "Immunologic Assessment",
              "Recommendations",
              "Next Steps"
            ],
            "signature": "Transplant Evaluation Committee"
          }
        },
        "transplantCriteria": {
          "kidney": {
            "renalFunction": {
              "gfrThreshold": 20,
              "creatinineMax": 4
            },
            "comorbidities": [
              "Uncontrolled diabetes",
              "Active malignancy",
              "Recent MI"
            ],
            "ageConsiderations": "No strict age limit but comprehensive geriatric assessment for patients >65"
          }
        }
      },
      "messageToUseWhenInitiatingConversation": "Hello, I'm an agent representing City General Transplant Center. I'm reaching out regarding a transplant referral we received for prospective patient John Doe (DOB: 1980-05-15, our MRN: TC-12345). The referral indicates possible end-stage renal disease requiring kidney transplant evaluation. To proceed efficiently, could you please confirm: 1) Your hospital's MRN for this patient, 2) The referring nephrologist's contact information, and 3) What recent labs, imaging studies, and HLA typing you have available? I'd like to align on our specific documentation requirements and discuss any data format considerations before diving into details."
    },
    {
      "agentId": "referring_hospital",
      "principal": {
        "type": "organization",
        "name": "Regional General Hospital",
        "description": "Community hospital with EHR system providing patient data for external referrals"
      },
      "situation": "Patient John Doe (MRN: RH-67890, DOB: 1980-05-15) has been referred to a transplant center for kidney evaluation. The EHR contains recent labs, imaging, and HLA typing, but formats may differ from transplant center standards.",
      "systemPrompt": "You are an agent representing Regional General Hospital. Your role is to assist external transplant centers by providing relevant patient data from our EHR for referral evaluations. First, verify the requesting organization's identity and authority (confirm NPI or institutional affiliation), then confirm patient details (full name, DOB, MRN) match our records exactly. If any identifiers are missing or ambiguous, request clarification before retrieving any data. Once verified, negotiate the specific data needed (e.g., renal function labs from last 6 months, recent kidney imaging, HLA typing) and preferred format. For HLA data, note that our system provides antigen-based reporting and discuss if allele-level conversion or additional testing is needed. Use tools to fetch targeted information progressivelyâ€”start with summaries and provide full reports only when specifically requested. Share data as attachments on messages, not through tools. When all requested data has been provided, use the confirmation tool to generate formal release authorization before ending the conversation.",
      "goals": [
        "Verify requesting transplant center and patient identity",
        "Provide targeted labs, imaging, and HLA data upon request",
        "Facilitate HLA format normalization through conversation"
      ],
      "tools": [
        {
          "toolName": "search_patient_ehr",
          "description": "Search the EHR system using natural language queries to find patient records, labs, or imaging reports",
          "inputSchema": {
            "type": "object",
            "properties": {
              "query": {
                "type": "string",
                "description": "Natural language search query (e.g., 'renal function labs for patient RH-67890 from September 2024')"
              },
              "patientId": {
                "type": "string",
                "description": "Optional: Patient MRN if not included in query"
              },
              "dateRange": {
                "type": "string",
                "description": "Optional: Date range for records (e.g., 'last 6 months')"
              }
            },
            "required": [
              "query"
            ]
          },
          "synthesisGuidance": "Search knowledgeBase.patientRecords matching the query parameters. Return relevant clinical data as structured markdown with dates, values, reference ranges, and interpretations. Include only data relevant to the specific requestâ€”avoid comprehensive dumps.",
          "endsConversation": false
        },
        {
          "toolName": "retrieve_imaging_reports",
          "description": "Retrieve detailed imaging reports and findings using natural language query",
          "inputSchema": {
            "type": "object",
            "properties": {
              "query": {
                "type": "string",
                "description": "Natural language query for imaging (e.g., 'kidney ultrasound reports for patient RH-67890 from last 3 months')"
              }
            },
            "required": [
              "query"
            ]
          },
          "synthesisGuidance": "Search knowledgeBase.patientRecords.imaging matching the query. Return as professional radiology report format with date, modality, findings, impression, and radiologist signature. Include relevant images descriptions if available.",
          "endsConversation": false
        },
        {
          "toolName": "retrieve_hla_typing",
          "description": "Retrieve HLA typing results from the immunology database using natural language query",
          "inputSchema": {
            "type": "object",
            "properties": {
              "query": {
                "type": "string",
                "description": "Natural language query for HLA data (e.g., 'HLA typing for patient RH-67890 including collection date and methodology')"
              }
            },
            "required": [
              "query"
            ]
          },
          "synthesisGuidance": "Search knowledgeBase.patientRecords.hlaTyping matching the query. Return as structured immunology report in antigen format with locus breakdown (A, B, DR), collection date, testing lab, and resolution level. Note if high-resolution typing is available or if only serologic/antigen level data exists.",
          "endsConversation": false
        },
        {
          "toolName": "confirm_data_release",
          "description": "Formally confirm release of patient data for transplant evaluation and generate authorization documentation",
          "inputSchema": {
            "type": "object",
            "properties": {
              "patientId": {
                "type": "string",
                "description": "Patient MRN"
              },
              "requestingOrganization": {
                "type": "string",
                "description": "Name of requesting transplant center"
              },
              "dataTypesReleased": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "List of data types released (e.g., ['labs', 'imaging', 'HLA'])"
              }
            },
            "required": [
              "patientId",
              "requestingOrganization",
              "dataTypesReleased"
            ]
          },
          "synthesisGuidance": "Generate formal data release authorization using knowledgeBase.ehrPolicies. Include patient identifiers, requesting organization, data types released, date, and compliance statements (HIPAA, etc.). Format as official hospital document.",
          "endsConversation": true,
          "conversationEndStatus": "neutral"
        }
      ],
      "knowledgeBase": {
        "patientRecords": {
          "RH-67890": {
            "name": "John Doe",
            "dob": "1980-05-15",
            "mrn": "RH-67890",
            "labs": [
              {
                "date": "2024-09-15",
                "type": "renal_function",
                "creatinine": 3.2,
                "referenceRange": "0.6-1.2 mg/dL",
                "gfr": 18,
                "referenceRangeGfr": ">90 mL/min",
                "interpretation": "Stage 4 CKD",
                "provider": "Dr. Emily Carter"
              },
              {
                "date": "2024-08-20",
                "type": "renal_function",
                "creatinine": 2.8,
                "gfr": 22,
                "interpretation": "Progressive decline from prior 28 mL/min"
              },
              {
                "date": "2024-09-15",
                "type": "complete_blood_count",
                "hemoglobin": 10.2,
                "hematocrit": 31.5,
                "interpretation": "Anemia of chronic disease"
              },
              {
                "date": "2024-09-10",
                "type": "urinalysis",
                "protein": "3+",
                "rbc": "Numerous",
                "interpretation": "Nephrotic range proteinuria"
              }
            ],
            "imaging": [
              {
                "date": "2024-09-20",
                "type": "kidney_ultrasound",
                "modality": "Ultrasound",
                "findings": "Bilateral renal atrophy with increased echogenicity. Right kidney 8.2 cm, left kidney 8.0 cm (both below normal). No hydronephrosis or obstruction. No renal calculi.",
                "impression": "Chronic kidney disease with bilateral small kidneys",
                "radiologist": "Dr. Michael Lee, MD"
              },
              {
                "date": "2024-07-15",
                "type": "abdominal_ct",
                "modality": "CT with contrast",
                "findings": "Small kidneys with thinned cortex. No masses or cysts. Mild ascites.",
                "impression": "Findings consistent with end-stage renal disease",
                "radiologist": "Dr. Sarah Kim, MD"
              }
            ],
            "hlaTyping": {
              "antigens": {
                "A": [
                  "A1",
                  "A2"
                ],
                "B": [
                  "B8",
                  "B44"
                ],
                "C": [
                  "Cw7"
                ],
                "DR": [
                  "DR3",
                  "DR4"
                ],
                "DQ": [
                  "DQ2",
                  "DQ8"
                ]
              },
              "collectionDate": "2024-08-01",
              "lab": "Hospital Immunology Lab",
              "methodology": "Serologic typing (antigen level)",
              "resolution": "Low-resolution; high-resolution typing recommended for transplant evaluation",
              "notes": "Patient has history of blood transfusion 2 years ago; PRA testing pending"
            },
            "medications": [
              {
                "name": "Lisinopril",
                "dose": "20mg daily",
                "purpose": "BP control"
              },
              {
                "name": "Furosemide",
                "dose": "40mg BID",
                "purpose": "Edema management"
              },
              {
                "name": "Sevelamer",
                "dose": "800mg TID with meals",
                "purpose": "Phosphate binder"
              }
            ],
            "comorbidities": [
              "Hypertension (15 years)",
              "Type 2 diabetes (8 years)",
              "Anemia of chronic kidney disease"
            ]
          }
        },
        "ehrPolicies": {
          "dataSharing": {
            "authorizedPartners": [
              "City General Transplant Center",
              "Statewide Transplant Network"
            ],
            "verificationRequirements": "Must confirm organization NPI, provider credentials, and patient consent",
            "dataMinimization": "Share only data relevant to specific clinical request",
            "retention": "Released data available in audit log for 7 years"
          },
          "hlaDataFormat": "Our system uses antigen-level reporting per ASHI standards. Allele-level typing available upon special request.",
          "imagingAccess": "Reports available immediately; actual images require separate PACS access request"
        },
        "releaseTemplates": {
          "dataAuthorization": "Standard form for authorizing release of protected health information for transplant evaluation"
        }
      },
      "messageToUseWhenInitiatingConversation": "Hello, I'm an agent representing Regional General Hospital. For patient data requests related to transplant referrals or external evaluations, please provide: 1) Patient's full name and date of birth, 2) Your organization's name and NPI (if applicable), 3) The referring provider's details, and 4) The specific clinical purpose and data types needed (e.g., recent labs, imaging reports, HLA typing). Once we verify these details against our records, we can discuss availability, formats, and coordinate secure data sharing. All releases require formal authorization per our policies."
    }
  ]
}
