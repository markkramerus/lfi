{
  "metadata": {
    "id": "clinical_trial_eligibility_screening",
    "title": "Clinical Trial Eligibility Screening for T2DM",
    "tags": [
      "healthcare",
      "clinical-trials",
      "patient-matching",
      "EHR"
    ],
    "description": "An agent for a clinician works with an agent for a clinical trial manager to determine if a patient with Type 2 Diabetes is eligible for an ongoing study. This scenario includes a clarification loop where the trial agent must request more specific information to resolve an ambiguous criterion.",
    "background": "This scenario models the common back-and-forth required to match patients to complex clinical trial protocols. Initial patient summaries often lack the specific details needed for a definitive match (e.g., 'on metformin' vs. 'on a *stable dose* of metformin for 3 months'). This requires a clarification cycle, which this configuration is designed to elicit.",
    "challenges": [
      "Handling ambiguous criteria ('stable dose').",
      "Managing a multi-step verification process that requires follow-up questions.",
      "Synthesizing data from a knowledge base into different formats (protocol summary vs. patient note).",
      "Ensuring the conversation concludes with a formal, logged, but provisional outcome."
    ]
  },
  "agents": [
    {
      "agentId": "clinician_agent",
      "principal": {
        "type": "individual",
        "name": "Dr. Anya Sharma",
        "description": "A primary care physician at a busy urban clinic."
      },
      "situation": "Dr. Sharma is in a consultation with her patient, Camila Lopez, who has expressed interest in new treatment options for her T2DM. Dr. Sharma wants to quickly check for potential clinical trial eligibility.",
      "systemPrompt": "You are an AI agent representing Dr. Anya Sharma, a clinician. Your task is to communicate with a clinical trial manager's agent to determine if Dr. Sharma's patient, Camila Lopez (MRN: E4107), is a suitable candidate for a clinical trial. You will use your tools to access the patient's electronic health record (EHR) in response to queries. Always consider querying the EHR for any needed detail, even if you think you have already seen the full record, as additional relevant information may exist. Be precise, professional, and provide information only as it is requested.",
      "goals": [
        "Identify a suitable clinical trial for patient Camila Lopez.",
        "Provide accurate clinical information from the patient's record to the trial manager's agent.",
        "Successfully complete the eligibility screening process."
      ],
      "tools": [
        {
          "toolName": "query_patient_ehr",
          "description": "Query the Electronic Health Record (EHR) for patient Camila Lopez (MRN: E4107) using a natural language question to retrieve clinical details, lab results, and notes.",
          "inputSchema": {
            "type": "object",
            "properties": {
              "query": {
                "type": "string",
                "description": "A natural language question about the patient's clinical history, labs, medications, or demographics. Example: 'What is the patient's latest HbA1c and BMI?' or 'How long has the patient been on her current metformin dose?'"
              }
            },
            "required": [
              "query"
            ]
          },
          "synthesisGuidance": "Synthesize the findings from the knowledgeBase into a professional, human-readable markdown document. Format it like a clinical note or a lab report summary. Include relevant dates and values. If a specific piece of information is not found, state that it is not documented.",
          "endsConversation": false
        }
      ],
      "knowledgeBase": {
        "patientRecord": {
          "name": "Camila Lopez",
          "mrn": "E4107",
          "dob": "1987-09-12",
          "age": 37,
          "demographics": {
            "heightCm": 162,
            "weightKg": 90
          },
          "bmi": 34.3,
          "pastMedicalHistory": [
            {
              "condition": "Type 2 Diabetes Mellitus (T2DM)",
              "diagnosisDate": "2017-05-20"
            },
            {
              "condition": "Hypertension",
              "status": "well-controlled"
            }
          ],
          "medications": [
            {
              "name": "Metformin HCL",
              "dose": "1000 mg BID",
              "startDate": "2025-01-15",
              "isStable": true
            },
            {
              "name": "Lisinopril",
              "dose": "20 mg daily"
            }
          ],
          "labs": [
            {
              "test": "HbA1c",
              "value": "8.1%",
              "date": "2025-07-12"
            }
          ],
          "flags": {
            "isPregnant": false,
            "plansToConceive": false,
            "isBreastfeeding": false,
            "historyOfPancreatitis": false,
            "personalHistoryOfThyroidCarcinoma": false,
            "familyHistoryOfThyroidCarcinoma": false
          }
        }
      },
      "messageToUseWhenInitiatingConversation": "Hello, I am an agent representing Dr. Anya Sharma. I'm reaching out about a patient with Type 2 Diabetes who may be a candidate for an ongoing study. The patient is a 37-year-old female on metformin with an HbA1c over 8%."
    },
    {
      "agentId": "trial_manager_agent",
      "principal": {
        "type": "organization",
        "name": "Innovate Clinical Research Unit",
        "description": "A research organization conducting pharmaceutical trials."
      },
      "situation": "You are monitoring incoming requests from clinicians about trial eligibility. One of your key trials is the GLP-1 Candidate Trial, which is actively recruiting.",
      "systemPrompt": "You are an AI agent representing Alex Chen, a Clinical Trial Manager. Your role is to screen potential candidates by requesting eligibility information step‑wise. **Ask for only one or two specific data points per message** (e.g., first request age and confirmed T2DM diagnosis; after receiving a reply, ask for the next one or two items such as latest HbA1c, then BMI, then current metformin use). **Never request a full EHR abstract up front.** When you need clinical data, **request a concise EHR abstract attachment that includes only the specific data points you just asked for**. After the basic set is collected, enter a “gather mode” where you ask for each additional, more complex criterion **one at a time** (e.g., duration of stable metformin dose, pregnancy status, history of pancreatitis). Use your tools to look up trial protocols and criteria. Systematically move from inclusion to exclusion criteria, and ask for clarification only when a response is ambiguous or incomplete.",
      "goals": [
        "Identify the most suitable trial for the presented patient profile.",
        "Systematically verify all inclusion and exclusion criteria for the selected trial.",
        "Make a final determination of provisional eligibility and log the result."
      ],
      "tools": [
        {
          "toolName": "lookup_trial_protocol",
          "description": "Search the clinical trials database for a specific protocol or find a matching protocol based on a natural language query. Can be used to retrieve full protocol summaries or specific inclusion/exclusion criteria.",
          "inputSchema": {
            "type": "object",
            "properties": {
              "query": {
                "type": "string",
                "description": "A natural language query about a trial. Example: 'Find a trial for T2DM patients on metformin' or 'List the exclusion criteria for the GLP-1 study'."
              }
            },
            "required": [
              "query"
            ]
          },
          "synthesisGuidance": "Return the requested trial information as a structured markdown document. Provide the high-level details, including full inclusion and exclusion criteria.",
          "endsConversation": false
        },
        {
          "toolName": "log_provisional_eligibility_decision",
          "description": "Records the final provisional eligibility decision for a patient in the trial screening log. This tool MUST be used only after all criteria have been evaluated to conclude the screening process.",
          "inputSchema": {
            "type": "object",
            "properties": {
              "patientMrn": {
                "type": "string"
              },
              "trialId": {
                "type": "string"
              },
              "decision": {
                "type": "string",
                "enum": [
                  "Provisionally Eligible",
                  "Not Eligible",
                  "Needs More Information"
                ]
              },
              "reasoning": {
                "type": "string",
                "description": "A brief summary of why the decision was made."
              },
              "criteriaEvaluation": {
                "type": "array",
                "description": "Evaluation of each inclusion/exclusion criterion.",
                "items": {
                  "type": "object",
                  "properties": {
                    "criterion": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string",
                      "enum": [
                        "inclusion",
                        "exclusion"
                      ]
                    },
                    "sourceData": {
                      "type": "string",
                      "description": "Reference to the data used (e.g., lab result, medication record)."
                    },
                    "met": {
                      "type": "string",
                      "enum": [
                        "met",
                        "not met",
                        "unknown"
                      ],
                      "description": "Whether the criterion was satisfied."
                    }
                  },
                  "required": [
                    "criterion",
                    "type",
                    "sourceData",
                    "met"
                  ]
                }
              }
            },
            "required": [
              "patientMrn",
              "trialId",
              "decision",
              "reasoning",
              "criteriaEvaluation"
            ]
          },
          "synthesisGuidance": "Generate a JSON object that records the provisional eligibility decision. Include the patientMrn, trialId, decision, reasoning, and a detailed 'criteriaEvaluation' array where each entry contains the criterion text, its type (inclusion or exclusion), the source data referenced, and whether the criterion was met, not met, or unknown. Ensure the output is valid JSON and serves as a formal screening log.",
          "endsConversation": true,
          "conversationEndStatus": "neutral"
        }
      ],
      "knowledgeBase": {
        "trials": [
          {
            "id": "NCT0xxxxxxx",
            "title": "GLP-1 Candidate Trial",
            "description": "A Phase III Trial of a Novel GLP-1 Receptor Agonist for Patients with Type 2 Diabetes on Metformin.",
            "inclusionCriteria": [
              "Age: 18 to 75 years",
              "Confirmed diagnosis of Type 2 Diabetes Mellitus (T2DM)",
              "HbA1c between 7.5% and 10.5% (inclusive)",
              "Body Mass Index (BMI) ≥ 30 kg/m²",
              "On a stable dose of metformin for at least 3 months prior to screening"
            ],
            "exclusionCriteria": [
              "Currently pregnant, breastfeeding, or planning to conceive",
              "Documented history of pancreatitis",
              "Personal or family history of medullary thyroid carcinoma"
            ]
          }
        ]
      },
      "messageToUseWhenInitiatingConversation": "Hello, I'm an agent for the Innovate Clinical Research Unit. We are actively recruiting for several studies and are reaching out to see if you have any potentially eligible patients in your practice."
    }
  ]
}